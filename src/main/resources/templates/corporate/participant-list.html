<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>참여자 관리 | TRY-CATCH</title>
    <link rel="stylesheet" href="/css/corporate/header.css">
    <link rel="stylesheet" href="/css/corporate/footer.css">
    <link rel="stylesheet" href="/css/corporate/participant-list.css">
</head>
<body class="mtcPersonScrap">
    <div id="wrap" class="wrapper">
        <div th:replace="~{corporate/header :: header}"></div>
        <div class="sideTrue devUseTopBtn section-wrap" id="container">

            <!-- 참여자 관리 -->
            <div class="participant-list-section">
                <div class="inner">
                    <div class="border-round-section">
                        <div class="status-box">
                            <div class="topArea">
                                <h2 class="subTits">참여자 관리</h2>
                            </div>
                            <ul class="status-list">
                                <li>
                                    <a th:href="@{/corporate/participant-list(programId=${programId})}"
                                       th:classappend="${currentStatus == '' or currentStatus == null} ? 'active' : ''">
                                        전체
                                        <em th:text="${participantWithPaging.statusCounts['total'] ?: 0}">0</em>
                                    </a>
                                </li>
                                <li>
                                    <a th:href="@{/corporate/participant-list(programId=${programId}, status='in_progress')}"
                                       th:classappend="${currentStatus == 'in_progress'} ? 'active' : ''">
                                        참여중
                                        <em th:text="${participantWithPaging.statusCounts['inProgress'] ?: 0}">0</em>
                                    </a>
                                </li>
                                <li>
                                    <a th:href="@{/corporate/participant-list(programId=${programId}, status='failed')}"
                                       th:classappend="${currentStatus == 'failed'} ? 'active' : ''">
                                        승급탈락/중도탈락
                                        <em th:text="${participantWithPaging.statusCounts['failed'] ?: 0}">0</em>
                                    </a>
                                </li>
                                <li>
                                    <a th:href="@{/corporate/participant-list(programId=${programId}, status='completed')}"
                                       th:classappend="${currentStatus == 'completed'} ? 'active' : ''">
                                        참여완료
                                        <em th:text="${participantWithPaging.statusCounts['completed'] ?: 0}">0</em>
                                    </a>
                                </li>
                            </ul>
                        </div>

                        <!-- 참여자 리스트 -->
                        <table class="participant-list-table">
                            <tbody>
                                <tr>
                                    <th></th>
                                    <th>
                                        <button class="order-button">이름/나이</button>
                                    </th>
                                    <th>
                                        <div class="order-select-box">
                                            <button class="order-button">전화번호</button>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="order-select-box">
                                            <button class="order-button">이메일</button>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="order-select-box">
                                            <button class="order-button">자기소개서</button>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="order-select-box">
                                            <button class="order-button">현재 상태</button>
                                        </div>
                                    </th>
                                    <th></th>
                                    <th></th>
                                </tr>

                                <!-- data가 없을 경우 -->
                                <tr class="data-none-case" th:if="${#lists.isEmpty(participantWithPaging.list)}">
                                    <td colspan="8">
                                        <div class="icon-frown"></div>
                                        <div class="large-text">참여자가 없습니다.</div>
                                    </td>
                                </tr>

                                <!-- data 있을 경우 -->
                                <tr th:each="p : ${participantWithPaging.list}" th:id="'participant-' + ${p.id}" th:data-id="${p.id}">
                                    <td class="profile-img">
                                        <div class="tdInner">
                                            <a class="photoItem linkProfile devLinkProfile" href="">
                                                <span class="itemWrap">
                                                    <span class="photoEl not-read">
                                                        <span class="imgDefault"></span>
                                                    </span>
                                                    <span class="maskEl"></span>
                                                </span>
                                            </a>
                                        </div>
                                    </td>
                                    <td>
                                        <a class="nameItem linkProfile devLinkProfile" href="">
                                            <span class="name" th:text="${p.memberName}">홍길동</span>
                                            <span class="nmAge">
                                                <span th:text="${p.individualMemberGender != null and p.individualMemberGender.name() == 'MAN'} ? '남' : '여'">여</span>
                                            </span>
                                        </a>
                                    </td>
                                    <td>
                                        <span class="contact" th:text="${p.memberPhone}">010-1234-1234</span>
                                    </td>
                                    <td>
                                        <span class="contact" th:text="${p.memberEmail}">test@gmail.com</span>
                                    </td>
                                    <td>
                                        <button type="button" class="btnMtcTpl devLinkResume">자기소개서 보기</button>
                                    </td>
                                    <td>
                                        <!-- 참여중 -->
                                        <span th:if="${p.challengerStatus.name() == 'IN_PROGRESS'}">참여중</span>
                                        <!-- 승급탈락 -->
                                        <span class="rejection" th:if="${p.challengerStatus.name() == 'STEP_FAILED'}">승급탈락</span>
                                        <!-- 중도탈락 -->
                                        <span class="rejection" th:if="${p.challengerStatus.name() == 'OUT_OF_PROCESS'}">중도탈락</span>
                                        <!-- 참여완료 -->
                                        <span class="complete" th:if="${p.challengerStatus.name() == 'COMPLETED'}">완료</span>
                                    </td>
                                    <td>
                                        <!-- 참여중일 때만 액션 버튼 표시 -->
                                        <th:block th:if="${p.challengerStatus.name() == 'IN_PROGRESS'}">
                                            <button type="button" class="moreOptionButton">
                                                <span>
                                                    <svg focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"></path></svg>
                                                </span>
                                            </button>
                                            <div class="more-option">
                                                <ul>
                                                    <li class="challengerPromoteBtn">
                                                        <button type="button">승급</button>
                                                    </li>
                                                    <li class="challengerRejectBtn">
                                                        <button type="button">탈락</button>
                                                    </li>
                                                    <li class="challengerDelBtn">
                                                        <button type="button">중도 탈락</button>
                                                    </li>
                                                </ul>
                                            </div>
                                        </th:block>
                                    </td>
                                    <td></td>
                                </tr>

                            </tbody>
                        </table>

                        <!-- 페이지네이션 -->
                        <div class="button_area" th:if="${!#lists.isEmpty(participantWithPaging.list)}">
                            <div class="tplPagination">
                                <ul>
                                    <li th:if="${participantWithPaging.criteria.page > 1}">
                                        <a th:href="@{/corporate/participant-list(programId=${programId}, status=${currentStatus}, page=${participantWithPaging.criteria.page - 1})}">&#8249;</a>
                                    </li>
                                    <th:block th:each="pageNum : ${#numbers.sequence(participantWithPaging.criteria.startPage, participantWithPaging.criteria.endPage)}">
                                        <li>
                                            <a th:href="@{/corporate/participant-list(programId=${programId}, status=${currentStatus}, page=${pageNum})}"
                                               th:text="${pageNum}"
                                               th:classappend="${pageNum == participantWithPaging.criteria.page} ? 'now' : ''">1</a>
                                        </li>
                                    </th:block>
                                    <li th:if="${participantWithPaging.criteria.page < participantWithPaging.criteria.realEnd}">
                                        <a th:href="@{/corporate/participant-list(programId=${programId}, status=${currentStatus}, page=${participantWithPaging.criteria.page + 1})}">&#8250;</a>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <div class="notice-box">
                            <ul class="point-bullet-list">
                                <li>
                                    참여자의 개인정보는 <strong>개인정보보호정책에 의거 프로그램 운영 목적으로만</strong> 이용하셔야 합니다.
                                </li>
                                <li>
                                    참여자 정보는 프로그램 종료일로부터 1년간 보관되며, 이후 자동으로 삭제됩니다.
                                </li>
                                <li>
                                    참여자의 연락처 및 자기소개서는 승인 처리 후 열람하실 수 있습니다.
                                </li>
                                <li>
                                    <strong>승급 거부 처리 시 참여자에게 사유를 안내</strong>해 주시기 바랍니다.
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 피드백 모달 -->
            <div class="common-modal feedback-modal">
                <div class="modal-dimmed"></div>
                <div class="modal-contents">
                    <button class="close-button"></button>
                    <div class="modal-head">
                        <h2>참여자 탈락 처리</h2>
                        <p class="head-desc">
                            탈락 처리하시겠습니까?
                        </p>
                    </div>
                    <fieldset>
                        <form method="post" id="form" name="form">
                            <div class="modal-data">
                                <div class="data-info">
                                    <div class="row_group">
                                        <div class="form_feedback flex-start">
                                            <div class="col_2 ">
                                                <textarea id="feedback" style="resize: none; width: 430px; height: 200px;"
                                                placeholder="참여자의 성장에 도움이 될 피드백을 작성해 주세요! (예: 강점, 개선점, 응원 메시지 등)"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-bts">
                                <button type="button" class="modal-btn cancel">취소</button>
                                <button type="button" class="modal-btn reject">탈락 처리</button>
                            </div>
                        </form>
                    </fieldset>
                </div>
            </div>
        </div>
        <div th:replace="~{corporate/footer :: footer}"></div>
    </div>
</body>
<script th:inline="javascript">
    const programId = /*[[${programId}]]*/ 0;
</script>
<script src="/js/corporate/participant-list/event.js"></script>
</html>
